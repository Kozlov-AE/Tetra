<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:12pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#000000;">Cоздавайте объект типа ListCollectionView прямо во ViewModel и используйте его в биндингах. Соответственно, всю сортировку (лучше использовать свойство ListCollectionView.CustomSort, что увеличит скорость сортировки) и фильтрацию можно будет сделать во ViewModel. Вроде подводных камней в таком решении нет. В качестве коллекции-источника для ListCollectionView можно взять обычную ObservableCollection. Данные для коллекции-источника по возможности формируйте в отдельном потоке (если не хочется получить чёрные окна вместо интерфейса), но учтите, что заполнять ObservableCollection придётся в UI-потоке, потому что CollectionView, которая будет дёргаться при изменениях в коллекции-источнике, может работать только в UI-потоке (так уж спроектированы все наследники ICollectionView, наследуются от DispatcherObject). Поэтому, лучше всего, коллекцию-источник заполнять через Dispatcher.BeginInvoke (ViewModel рекомендую наследовать от DispatcherObject) по одному элементу за раз, желательно с приоритетом DispatcherPriority.Background. То же самое, в коде: </span></p>
<p style=" margin-top:4px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">public class</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> MyViewModel : DispatcherObject, INotifyPropertyChanged</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">private readonly</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> IEnumerable&lt;Data&gt; myData;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">private readonly</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> ObservableCollection&lt;DataViewModel&gt; myCollection;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">private</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> ListCollectionView myCollectionView;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">public</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> MyViewModel(IEnumerable&lt;Data&gt; data)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        myData = data;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        myCollection = </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">new</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> ObservableCollection&lt;DataViewModel&gt;();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">public</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> ListCollectionView MyCollection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">get</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> { </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">return</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> myCollectionView ?? CreateMyCollectionView(); }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">private</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> ListCollectionView CreateMyCollectionView()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        myCollectionView = </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">new</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> ListCollectionView(myCollection) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            CustomSort = </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">new</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> MyComparer(),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            Filter = MyFilter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        };</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        FetchData(myData, dataObject =&gt; myCollection.Add(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">new</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> DataViewModel(dataObject)));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">return</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> myCollectionView;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">protected void</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> FetchData&lt;T&gt;(IEnumerable&lt;T&gt; data, Action&lt;T&gt; fetch)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        State = ViewModelState.Fetching;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">var</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> dataEnumerator = data.GetEnumerator();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        Dispatcher.BeginInvoke(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">new</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> Action&lt;IEnumerator&lt;T&gt;, Action&lt;T&gt;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            (</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                FetchDataImpl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            DispatcherPriority.Background,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            dataEnumerator, fetch</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        );</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">private void</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> FetchDataImpl&lt;T&gt;(IEnumerator&lt;T&gt; sourceEnumerator, Action&lt;T&gt; fetch)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> (!sourceEnumerator.MoveNext()) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            State = ViewModelState.Active;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">return</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        fetch(sourceEnumerator.Current);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        Dispatcher.BeginInvoke(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">new</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> Action&lt;IEnumerator&lt;T&gt;, Action&lt;T&gt;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            (</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    FetchDataImpl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            DispatcherPriority.Background,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            sourceEnumerator, fetch</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        );</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:4px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#000000;">Сегодня наткнулся на интересный вариант решения проблемы с обновлением CollectionView/ObservableCollection из другого потока, здесь коллекция-источник посылает уведомления о своём изменении в подходящем контексте синхронизации, что позволяет заполнять/изменять её в отдельном потоке. Этот класс надо иcпользовать вместо ObservableCollection/FetchData и можно забивать его данными в отдельном потоке: </span></p>
<p style=" margin-top:4px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">/// &lt;summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">/// An ObservableCollection&amp;lt;T&amp;gt; enhanced with capability of free threading.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">/// &lt;/summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">[Serializable]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">public class</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> BindableCollection&lt;T&gt; : ObservableCollection&lt;T&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">/// &lt;summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// Initializes a new instance of the&lt;see cref=&quot;BindingCollection&amp;lt;T&amp;gt;&quot;&gt;BindingCollection&lt;/see&gt;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// &lt;/summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">public</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> BindableCollection() : </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">base</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">() { }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">/// &lt;summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// Initializes a new instance of the&lt;see cref=&quot;BindingCollection&amp;lt;T&amp;gt;&quot;&gt;BindingCollection&lt;/see&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// class that contains elements copied from the specified List&amp;lt;T&amp;gt;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// &lt;/summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// &lt;param name=&quot;list&quot;&gt;The list from which the elements are copied.&lt;/param&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// &lt;exception cref=&quot;System.ArgumentNullException&quot;&gt;The list parameter cannot be null.&lt;/exception&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">public</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> BindableCollection(List&lt;T&gt; list) : </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">base</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">(list) { }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">/// &lt;summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// Initializes a new instance of the&lt;see cref=&quot;BindingCollection&amp;lt;T&amp;gt;&quot;&gt;BindingCollection&lt;/see&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// class that contains elements copied from the specified IEnumerable&amp;lt;T&amp;gt;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// &lt;/summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// &lt;param name=&quot;list&quot;&gt;The list from which the elements are copied.&lt;/param&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// &lt;exception cref=&quot;System.ArgumentNullException&quot;&gt;The list parameter cannot be null.&lt;/exception&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">public</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> BindableCollection(IEnumerable&lt;T&gt; list)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> (list == </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">null</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">throw new</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> ArgumentNullException(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#8b0000;">&quot;list&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">foreach</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> (</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">var</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> item </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">in</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> list) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            Items.Add(item);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">/// &lt;summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// Occurs when an item is added, removed, changed, moved, or the entire list is refreshed.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">    /// &lt;/summary&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">public override event</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> NotifyCollectionChangedEventHandler CollectionChanged;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">protected override void</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> OnCollectionChanged(NotifyCollectionChangedEventArgs e)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">var</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> collectionChanged = CollectionChanged;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Courier New,Courier,monospace'; color:#000000; background-color:#f4f4f4;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> (collectionChanged != </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">null</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">using</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> (</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">var</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> blockReentrancy = BlockReentrancy()) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">foreach</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> (</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">var</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> @</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">delegate in</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> collectionChanged.GetInvocationList()) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">var</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> dispatcherInvoker = @</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">delegate</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">.Target </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">as</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> DispatcherObject;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">var</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> syncInvoker = @</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">delegate</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">.Target </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">as</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> ISynchronizeInvoke;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> (dispatcherInvoker != </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">null</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">// We are running inside DispatcherSynchronizationContext,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">                        // so we should invoke the event handler in the correct dispatcher.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                        dispatcherInvoker.Dispatcher.Invoke(@</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">delegate</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">, DispatcherPriority.Background, </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">this</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">, e);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">else if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> (syncInvoker != </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">null</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">// We are running inside WindowsFormsSynchronizationContext,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">                        // so we should invoke the event handler in the correct context.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                        syncInvoker.Invoke(@</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">delegate</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">, </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">new object</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">[] { </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">this</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">, e });</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">else</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#008000;">// We are running in free threaded context, so just directly invoke the event handler.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">var</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;"> handler = (NotifyCollectionChangedEventHandler)@</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">delegate</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                        handler(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#0000ff;">this</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">, e);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:4px; margin-left:30px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f4f4f4;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; color:#000000;">}</span></p></body></html>